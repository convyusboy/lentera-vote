!function(exportCallback){"use strict";function isDefined(object){var propertyName;if(null===object||void 0===object)return!1;if(objectHelper.isArray(object))return object.length>0;if("string"==typeof object||"number"==typeof object||"boolean"==typeof object)return!0;for(propertyName in object)if(object.hasOwnProperty(propertyName)&&isDefined(object[propertyName]))return!0;return!1}var UriTemplateError=function(){function UriTemplateError(options){this.options=options}return UriTemplateError.prototype.toString=function(){return JSON&&JSON.stringify?JSON.stringify(this.options):this.options},UriTemplateError}(),objectHelper=function(){function isArray(value){return"[object Array]"===Object.prototype.toString.apply(value)}function isString(value){return"[object String]"===Object.prototype.toString.apply(value)}function isNumber(value){return"[object Number]"===Object.prototype.toString.apply(value)}function isBoolean(value){return"[object Boolean]"===Object.prototype.toString.apply(value)}function join(arr,separator){var index,result="",first=!0;for(index=0;index<arr.length;index+=1)first?first=!1:result+=separator,result+=arr[index];return result}function map(arr,mapper){for(var result=[],index=0;index<arr.length;index+=1)result.push(mapper(arr[index]));return result}function filter(arr,predicate){for(var result=[],index=0;index<arr.length;index+=1)predicate(arr[index])&&result.push(arr[index]);return result}function deepFreezeUsingObjectFreeze(object){if("object"!=typeof object||null===object)return object;Object.freeze(object);var property,propertyName;for(propertyName in object)object.hasOwnProperty(propertyName)&&(property=object[propertyName],"object"==typeof property&&deepFreeze(property));return object}function deepFreeze(object){return"function"==typeof Object.freeze?deepFreezeUsingObjectFreeze(object):object}return{isArray:isArray,isString:isString,isNumber:isNumber,isBoolean:isBoolean,join:join,map:map,filter:filter,deepFreeze:deepFreeze}}(),charHelper=function(){function isAlpha(chr){return chr>="a"&&"z">=chr||chr>="A"&&"Z">=chr}function isDigit(chr){return chr>="0"&&"9">=chr}function isHexDigit(chr){return isDigit(chr)||chr>="a"&&"f">=chr||chr>="A"&&"F">=chr}return{isAlpha:isAlpha,isDigit:isDigit,isHexDigit:isHexDigit}}(),pctEncoder=function(){function encodeCharacter(chr){var octet,index,result="",octets=utf8.encode(chr);for(index=0;index<octets.length;index+=1)octet=octets.charCodeAt(index),result+="%"+(16>octet?"0":"")+octet.toString(16).toUpperCase();return result}function isPercentDigitDigit(text,start){return"%"===text.charAt(start)&&charHelper.isHexDigit(text.charAt(start+1))&&charHelper.isHexDigit(text.charAt(start+2))}function parseHex2(text,start){return parseInt(text.substr(start,2),16)}function isPctEncoded(chr){if(!isPercentDigitDigit(chr,0))return!1;var firstCharCode=parseHex2(chr,1),numBytes=utf8.numBytes(firstCharCode);if(0===numBytes)return!1;for(var byteNumber=1;numBytes>byteNumber;byteNumber+=1)if(!isPercentDigitDigit(chr,3*byteNumber)||!utf8.isValidFollowingCharCode(parseHex2(chr,3*byteNumber+1)))return!1;return!0}function pctCharAt(text,startIndex){var chr=text.charAt(startIndex);if(!isPercentDigitDigit(text,startIndex))return chr;var utf8CharCode=parseHex2(text,startIndex+1),numBytes=utf8.numBytes(utf8CharCode);if(0===numBytes)return chr;for(var byteNumber=1;numBytes>byteNumber;byteNumber+=1)if(!isPercentDigitDigit(text,startIndex+3*byteNumber)||!utf8.isValidFollowingCharCode(parseHex2(text,startIndex+3*byteNumber+1)))return chr;return text.substr(startIndex,3*numBytes)}var utf8={encode:function(chr){return unescape(encodeURIComponent(chr))},numBytes:function(firstCharCode){return 127>=firstCharCode?1:firstCharCode>=194&&223>=firstCharCode?2:firstCharCode>=224&&239>=firstCharCode?3:firstCharCode>=240&&244>=firstCharCode?4:0},isValidFollowingCharCode:function(charCode){return charCode>=128&&191>=charCode}};return{encodeCharacter:encodeCharacter,isPctEncoded:isPctEncoded,pctCharAt:pctCharAt}}(),rfcCharHelper=function(){function isVarchar(chr){return charHelper.isAlpha(chr)||charHelper.isDigit(chr)||"_"===chr||pctEncoder.isPctEncoded(chr)}function isUnreserved(chr){return charHelper.isAlpha(chr)||charHelper.isDigit(chr)||"-"===chr||"."===chr||"_"===chr||"~"===chr}function isReserved(chr){return":"===chr||"/"===chr||"?"===chr||"#"===chr||"["===chr||"]"===chr||"@"===chr||"!"===chr||"$"===chr||"&"===chr||"("===chr||")"===chr||"*"===chr||"+"===chr||","===chr||";"===chr||"="===chr||"'"===chr}return{isVarchar:isVarchar,isUnreserved:isUnreserved,isReserved:isReserved}}(),encodingHelper=function(){function encode(text,passReserved){var index,result="",chr="";for(("number"==typeof text||"boolean"==typeof text)&&(text=text.toString()),index=0;index<text.length;index+=chr.length)chr=text.charAt(index),result+=rfcCharHelper.isUnreserved(chr)||passReserved&&rfcCharHelper.isReserved(chr)?chr:pctEncoder.encodeCharacter(chr);return result}function encodePassReserved(text){return encode(text,!0)}function encodeLiteralCharacter(literal,index){var chr=pctEncoder.pctCharAt(literal,index);return chr.length>1?chr:rfcCharHelper.isReserved(chr)||rfcCharHelper.isUnreserved(chr)?chr:pctEncoder.encodeCharacter(chr)}function encodeLiteral(literal){var index,result="",chr="";for(index=0;index<literal.length;index+=chr.length)chr=pctEncoder.pctCharAt(literal,index),result+=chr.length>1?chr:rfcCharHelper.isReserved(chr)||rfcCharHelper.isUnreserved(chr)?chr:pctEncoder.encodeCharacter(chr);return result}return{encode:encode,encodePassReserved:encodePassReserved,encodeLiteral:encodeLiteral,encodeLiteralCharacter:encodeLiteralCharacter}}(),operators=function(){function create(symbol){bySymbol[symbol]={symbol:symbol,separator:"?"===symbol?"&":""===symbol||"+"===symbol||"#"===symbol?",":symbol,named:";"===symbol||"&"===symbol||"?"===symbol,ifEmpty:"&"===symbol||"?"===symbol?"=":"",first:"+"===symbol?"":symbol,encode:"+"===symbol||"#"===symbol?encodingHelper.encodePassReserved:encodingHelper.encode,toString:function(){return this.symbol}}}var bySymbol={};return create(""),create("+"),create("#"),create("."),create("/"),create(";"),create("?"),create("&"),{valueOf:function(chr){return bySymbol[chr]?bySymbol[chr]:"=,!@|".indexOf(chr)>=0?null:bySymbol[""]}}}(),LiteralExpression=function(){function LiteralExpression(literal){this.literal=encodingHelper.encodeLiteral(literal)}return LiteralExpression.prototype.expand=function(){return this.literal},LiteralExpression.prototype.toString=LiteralExpression.prototype.expand,LiteralExpression}(),parse=function(){function parseExpression(expressionText){function closeVarname(){var varname=expressionText.substring(varnameStart,index);if(0===varname.length)throw new UriTemplateError({expressionText:expressionText,message:"a varname must be specified",position:index});varspec={varname:varname,exploded:!1,maxLength:null},varnameStart=null}function closeMaxLength(){if(maxLengthStart===index)throw new UriTemplateError({expressionText:expressionText,message:"after a ':' you have to specify the length",position:index});varspec.maxLength=parseInt(expressionText.substring(maxLengthStart,index),10),maxLengthStart=null}var operator,index,varspecs=[],varspec=null,varnameStart=null,maxLengthStart=null,chr="";for(operator=function(operatorText){var op=operators.valueOf(operatorText);if(null===op)throw new UriTemplateError({expressionText:expressionText,message:"illegal use of reserved operator",position:index,operator:operatorText});return op}(expressionText.charAt(0)),index=operator.symbol.length,varnameStart=index;index<expressionText.length;index+=chr.length){if(chr=pctEncoder.pctCharAt(expressionText,index),null!==varnameStart){if("."===chr){if(varnameStart===index)throw new UriTemplateError({expressionText:expressionText,message:"a varname MUST NOT start with a dot",position:index});continue}if(rfcCharHelper.isVarchar(chr))continue;closeVarname()}if(null!==maxLengthStart){if(index===maxLengthStart&&"0"===chr)throw new UriTemplateError({expressionText:expressionText,message:"A :prefix must not start with digit 0",position:index});if(charHelper.isDigit(chr)){if(index-maxLengthStart>=4)throw new UriTemplateError({expressionText:expressionText,message:"A :prefix must have max 4 digits",position:index});continue}closeMaxLength()}if(":"!==chr)if("*"!==chr){if(","!==chr)throw new UriTemplateError({expressionText:expressionText,message:"illegal character",character:chr,position:index});varspecs.push(varspec),varspec=null,varnameStart=index+1}else{if(null===varspec)throw new UriTemplateError({expressionText:expressionText,message:"exploded without varspec",position:index});if(varspec.exploded)throw new UriTemplateError({expressionText:expressionText,message:"exploded twice",position:index});if(varspec.maxLength)throw new UriTemplateError({expressionText:expressionText,message:"an explode (*) MUST NOT follow to a prefix",position:index});varspec.exploded=!0}else{if(null!==varspec.maxLength)throw new UriTemplateError({expressionText:expressionText,message:"only one :maxLength is allowed per varspec",position:index});if(varspec.exploded)throw new UriTemplateError({expressionText:expressionText,message:"an exploeded varspec MUST NOT be varspeced",position:index});maxLengthStart=index+1}}return null!==varnameStart&&closeVarname(),null!==maxLengthStart&&closeMaxLength(),varspecs.push(varspec),new VariableExpression(expressionText,operator,varspecs)}function parse(uriTemplateText){var index,chr,expressions=[],braceOpenIndex=null,literalStart=0;for(index=0;index<uriTemplateText.length;index+=1)if(chr=uriTemplateText.charAt(index),null===literalStart){if(null===braceOpenIndex)throw new Error("reached unreachable code");if("{"===chr)throw new UriTemplateError({templateText:uriTemplateText,message:"brace already opened",position:index});if("}"===chr){if(braceOpenIndex+1===index)throw new UriTemplateError({templateText:uriTemplateText,message:"empty braces",position:braceOpenIndex});try{expressions.push(parseExpression(uriTemplateText.substring(braceOpenIndex+1,index)))}catch(error){if(error.prototype===UriTemplateError.prototype)throw new UriTemplateError({templateText:uriTemplateText,message:error.options.message,position:braceOpenIndex+error.options.position,details:error.options});throw error}braceOpenIndex=null,literalStart=index+1}}else{if("}"===chr)throw new UriTemplateError({templateText:uriTemplateText,message:"unopened brace closed",position:index});"{"===chr&&(index>literalStart&&expressions.push(new LiteralExpression(uriTemplateText.substring(literalStart,index))),literalStart=null,braceOpenIndex=index)}if(null!==braceOpenIndex)throw new UriTemplateError({templateText:uriTemplateText,message:"unclosed brace",position:braceOpenIndex});return literalStart<uriTemplateText.length&&expressions.push(new LiteralExpression(uriTemplateText.substr(literalStart))),new UriTemplate(uriTemplateText,expressions)}return parse}(),VariableExpression=function(){function prettyPrint(value){return JSON&&JSON.stringify?JSON.stringify(value):value}function isEmpty(value){if(!isDefined(value))return!0;if(objectHelper.isString(value))return""===value;if(objectHelper.isNumber(value)||objectHelper.isBoolean(value))return!1;if(objectHelper.isArray(value))return 0===value.length;for(var propertyName in value)if(value.hasOwnProperty(propertyName))return!1;return!0}function propertyArray(object){var propertyName,result=[];for(propertyName in object)object.hasOwnProperty(propertyName)&&result.push({name:propertyName,value:object[propertyName]});return result}function VariableExpression(templateText,operator,varspecs){this.templateText=templateText,this.operator=operator,this.varspecs=varspecs}function expandSimpleValue(varspec,operator,value){var result="";if(value=value.toString(),operator.named){if(result+=encodingHelper.encodeLiteral(varspec.varname),""===value)return result+=operator.ifEmpty;result+="="}return null!==varspec.maxLength&&(value=value.substr(0,varspec.maxLength)),result+=operator.encode(value)}function valueDefined(nameValue){return isDefined(nameValue.value)}function expandNotExploded(varspec,operator,value){var arr=[],result="";if(operator.named){if(result+=encodingHelper.encodeLiteral(varspec.varname),isEmpty(value))return result+=operator.ifEmpty;result+="="}return objectHelper.isArray(value)?(arr=value,arr=objectHelper.filter(arr,isDefined),arr=objectHelper.map(arr,operator.encode),result+=objectHelper.join(arr,",")):(arr=propertyArray(value),arr=objectHelper.filter(arr,valueDefined),arr=objectHelper.map(arr,function(nameValue){return operator.encode(nameValue.name)+","+operator.encode(nameValue.value)}),result+=objectHelper.join(arr,",")),result}function expandExplodedNamed(varspec,operator,value){var isArray=objectHelper.isArray(value),arr=[];return isArray?(arr=value,arr=objectHelper.filter(arr,isDefined),arr=objectHelper.map(arr,function(listElement){var tmp=encodingHelper.encodeLiteral(varspec.varname);return tmp+=isEmpty(listElement)?operator.ifEmpty:"="+operator.encode(listElement)})):(arr=propertyArray(value),arr=objectHelper.filter(arr,valueDefined),arr=objectHelper.map(arr,function(nameValue){var tmp=encodingHelper.encodeLiteral(nameValue.name);return tmp+=isEmpty(nameValue.value)?operator.ifEmpty:"="+operator.encode(nameValue.value)})),objectHelper.join(arr,operator.separator)}function expandExplodedUnnamed(operator,value){var arr=[],result="";return objectHelper.isArray(value)?(arr=value,arr=objectHelper.filter(arr,isDefined),arr=objectHelper.map(arr,operator.encode),result+=objectHelper.join(arr,operator.separator)):(arr=propertyArray(value),arr=objectHelper.filter(arr,function(nameValue){return isDefined(nameValue.value)}),arr=objectHelper.map(arr,function(nameValue){return operator.encode(nameValue.name)+"="+operator.encode(nameValue.value)}),result+=objectHelper.join(arr,operator.separator)),result}return VariableExpression.prototype.toString=function(){return this.templateText},VariableExpression.prototype.expand=function(variables){var index,varspec,value,valueIsArr,expanded=[],oneExploded=!1,operator=this.operator;for(index=0;index<this.varspecs.length;index+=1)if(varspec=this.varspecs[index],value=variables[varspec.varname],null!==value&&void 0!==value)if(varspec.exploded&&(oneExploded=!0),valueIsArr=objectHelper.isArray(value),"string"==typeof value||"number"==typeof value||"boolean"==typeof value)expanded.push(expandSimpleValue(varspec,operator,value));else{if(varspec.maxLength&&isDefined(value))throw new Error("Prefix modifiers are not applicable to variables that have composite values. You tried to expand "+this+" with "+prettyPrint(value));varspec.exploded?isDefined(value)&&expanded.push(operator.named?expandExplodedNamed(varspec,operator,value):expandExplodedUnnamed(operator,value)):(operator.named||!isEmpty(value))&&expanded.push(expandNotExploded(varspec,operator,value))}return 0===expanded.length?"":operator.first+objectHelper.join(expanded,operator.separator)},VariableExpression}(),UriTemplate=function(){function UriTemplate(templateText,expressions){this.templateText=templateText,this.expressions=expressions,objectHelper.deepFreeze(this)}return UriTemplate.prototype.toString=function(){return this.templateText},UriTemplate.prototype.expand=function(variables){var index,result="";for(index=0;index<this.expressions.length;index+=1)result+=this.expressions[index].expand(variables);return result},UriTemplate.parse=parse,UriTemplate.UriTemplateError=UriTemplateError,UriTemplate}();exportCallback(UriTemplate)}(function(UriTemplate){"use strict";"undefined"!=typeof module?module.exports=UriTemplate:"function"==typeof define?define([],function(){return UriTemplate}):"undefined"!=typeof window?window.UriTemplate=UriTemplate:global.UriTemplate=UriTemplate});