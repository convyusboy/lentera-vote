var api,container,dataDownloadUri,downloadTraffic,enableRealtime,hostname,loadRealtime,multipartContainer,script,scripts,startRealtime;scripts=document.getElementsByTagName("script"),script=scripts[scripts.length-1],hostname=window.baseDomain,api=script.getAttribute("data-api"),container=script.getAttribute("data-container"),multipartContainer=script.getAttribute("data-multipart-container"),enableRealtime=script.getAttribute("data-enable-realtime"),dataDownloadUri=script.getAttribute("data-download-uri"),downloadTraffic=function(sectionEl){return $.ajax(dataDownloadUri,{success:function(data){return sectionEl.html(data),sectionEl.trigger("update")},error:function(jqXHR){return sectionEl.html("<p>Sorry, error while loading traffic. Please reload and try again.</p>"),sectionEl.trigger("error"),403===jqXHR.status?window.location=window.loginUri:void 0}})},startRealtime=function(){var socket;return window.socket=socket=io.connect("http://"+hostname),console&&socket&&console.log("connecting socket"),socket.on("connect",function(){return console&&console.log("socket connected"),$("body").addClass("connected"),api&&socket.json.send({watch:api}),console&&console.log("watching api",api),container||multipartContainer?socket.on("message",function(message){var multipartContainerLocalized;return console&&console.log("received socket message",message),container?(container.prepend(message.html),container.find(".noTraffic").remove(),container.find(".onTraffic").show(),console.log("triggering update of",container),container.trigger("update")):(multipartContainerLocalized=multipartContainer.replace("#{method}",message.data.method).replace("#{url}",message.data.url),$(multipartContainerLocalized).prepend(message.html),$(multipartContainerLocalized).find(".noTraffic").remove(),$(multipartContainerLocalized).find(".onTraffic").show())}):void 0}),socket.on("disconnect",function(){return console&&console.log("socket disconnected"),$("body").removeClass("connected")})},loadRealtime=function(){var head,newScript;return newScript=document.createElement("script"),head=document.getElementsByTagName("head")[0],newScript.src="http://"+hostname+"/socket.io/socket.io.js",newScript.type="text/javascript",newScript.onload=startRealtime,head.appendChild(newScript)},$(document).ready(function(){return container=$(container?container:"#trafficViewer, #leftColumn"),"1"===enableRealtime&&loadRealtime(),(null!=dataDownloadUri?dataDownloadUri.length:void 0)>0&&downloadTraffic(container),$(document).on("mousedown",".request > .requestDetails",function(){return!1}),$(document).on("click",".request > .requestDetails",function(){return $(this).closest(".request").toggleClass("expanded")}),container&&(container.delegate(".pane .collapser","click",function(){return $(this).closest(".pane").toggleClass("collapsed")}),container.delegate(".pane .collapser","mousedown",function(e){return e.stopPropagation(),!1})),$("#show_missed_reqs").change(function(){return"0"!==$("#show_missed_reqs").val()?$("#hideErrorsCss").remove():$("#hideErrorsCss").length?void 0:$('<style id="hideErrorsCss">.request.miss {display: none}</style>').appendTo("body")}),container.delegate(".expectedSwitcher","click",function(e){return e.preventDefault(),$(e.target).closest(".pane").toggleClass("expectedShown")})});